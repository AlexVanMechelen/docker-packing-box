#!/usr/bin/python3
# -*- coding: UTF-8 -*-
from pboxtools import re, run, suppress


def parse(output, **kwargs):
    r = []
    for l in output.splitlines():
        with suppress(AttributeError):
            r.append(re.search(r"^Detected tool\s+:\s+(.+)\s+(?:packer|protector)\s+(?:.+)$", l).group(1).lower() \
                     .replace("'s", "").replace(" ", "_").replace("(", "").replace(")", ""))
            continue
        if kwargs['weak']:
            with suppress(AttributeError):
                r.append(re.search(r"^Detected tool\s+:\s+(.+)$", l).group(1).lower() \
                         .replace("'s", "").replace(" ", "_").replace("(", "").replace(")", ""))
    return r


if __name__ == "__main__":
    run("RetDec", parse_func=parse, weak_assumptions=True)


"""
Detected tool            : Microsoft Linker (9.0) (linker), combined heuristic
Detected tool            : NeoLite (packer), section table heuristic
Detected tool            : Microsoft (linker), dos header style
Detected tool            : NeoLite (2.0) (packer), 16 from 16 significant nibbles (100%)
"""
